# Railway Deployment Fix - Database Setup

## The Problem
Railway's build environment can't access the internal database URL (`riddick-chess-db.railway.internal`), so `prisma db push` fails during build.

## The Solution
We need to run database setup **after deployment**, not during build.

## Option 1: Railway Deploy Hook (Recommended)

1. Go to Railway dashboard
2. Click on your **Web Service**
3. Go to **Settings** → **Deploy Hooks**
4. Add a **Post-Deploy Command**:
   ```
   npm run db:setup
   ```
5. Save and redeploy

## Option 2: Manual Setup via Railway CLI

1. **Install Railway CLI**:
   ```bash
   npm i -g @railway/cli
   ```

2. **Login**:
   ```bash
   railway login
   ```

3. **Link to your project**:
   ```bash
   railway link
   ```

4. **Run database setup**:
   ```bash
   railway run npm run db:setup
   ```

## Option 3: Run via Railway Dashboard

1. Go to Railway → Your Web Service
2. Click **"Deployments"** tab
3. Click on the latest deployment
4. Click **"Shell"** or **"Logs"**
5. Run:
   ```bash
   npm run db:setup
   ```

## Option 4: One-Time SQL Script (If above don't work)

If you have access to Railway's PostgreSQL query interface:

1. Go to Railway → PostgreSQL service
2. Click **"Query"** tab
3. Run the Prisma schema SQL manually

**OR** use Railway's built-in PostgreSQL admin:
1. Railway → PostgreSQL → **"Data"** tab
2. Tables should auto-create, but if not, run:
   ```sql
   -- This will be generated by Prisma, but as a fallback:
   -- Check if tables exist first
   SELECT table_name FROM information_schema.tables WHERE table_schema = 'public';
   ```

## Quick Fix Steps

1. ✅ Code is already pushed (build script fixed)
2. ⏳ Railway will rebuild automatically
3. ⏳ After build succeeds, run: `railway run npm run db:setup`
4. ✅ Login/signup should work!

## Verify Database Tables

After running setup, verify tables exist:

```bash
railway run npx prisma studio
```

Or check Railway PostgreSQL → Query tab:
```sql
SELECT table_name 
FROM information_schema.tables 
WHERE table_schema = 'public';
```

You should see:
- User
- Game
- Friend
- Message
- Tournament
- TournamentParticipant
- TournamentMatch
- Product
- etc.

## Troubleshooting

### "Can't reach database server"
- ✅ This is expected during build - database setup runs AFTER deployment
- ✅ Use one of the options above to run `npm run db:setup` after deployment

### "Table already exists"
- ✅ This is fine! Means tables are already created
- ✅ You can skip database setup

### Still getting 500 errors?
- Check Railway logs for specific Prisma errors
- Verify DATABASE_URL is set correctly
- Make sure PostgreSQL service is running

